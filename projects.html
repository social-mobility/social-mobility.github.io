<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rail GIS Project</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    #map {
      width: 100%;
      height: 600px;
      margin-top: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    #controller {
      margin: 20px 0;
    }

    #legend {
      background: white;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
      line-height: 1.2;
    }
  </style>
</head>

<body>
  <div class="container" style="padding:20px;">
    <h2>Rail Segment Visualization (with Attribute Coloring)</h2>
    <p>Select an attribute to visualize the Korean railway segments.</p>

    <!-- ğŸ”½ ì†ì„± ì„ íƒ ë“œë¡­ë‹¤ìš´ -->
    <div id="controller">
      <label><b>Color by attribute:</b></label>
      <select id="attributeSelect">
        <option value="route_count">route_count</option>
        <option value="curvature_R">curvature_R</option>
        <option value="elev_mean">elev_mean</option>
        <option value="elev_max">elev_max</option>
        <option value="slope_pct">slope_pct</option>
      </select>
    </div>
  </div>

  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    var map = L.map('map').setView([36.5, 128], 8);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    var geojsonData; // ë°ì´í„° ì €ì¥ìš©
    var geojsonLayer; // í˜„ì¬ ì§€ë„ ë ˆì´ì–´ ì €ì¥ìš©

    // GeoJSON ë¡œë“œ
    fetch("projects/rail_dem_small2.geojson")
      .then(res => res.json())
      .then(data => {
        geojsonData = data;
        updateMap("route_count");  // ê¸°ë³¸ê°’
      });

    // ğŸ”¥ ì†ì„±ê°’ â†’ ìƒ‰ìƒ ë§¤í•‘ í•¨ìˆ˜
    function getColor(value, min, max) {
      var t = (value - min) / (max - min); // 0~1 ì •ê·œí™”
      t = Math.max(0, Math.min(1, t));
      var r = Math.floor(255 * t);
      var g = Math.floor(255 * (1 - t));
      return "rgb(" + r + "," + g + ",0)";
    }

    // ğŸ”¥ ì†ì„±ë³„ë¡œ ì§€ë„ ì—…ë°ì´íŠ¸
    function updateMap(attribute) {
      // ê¸°ì¡´ ë ˆì´ì–´ ì œê±°
      if (geojsonLayer) {
        geojsonLayer.remove();
      }

      // ì†ì„± ê°’ ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
      var values = geojsonData.features
        .map(f => f.properties[attribute])
        .filter(v => v !== null && v !== undefined);

      var min = Math.min(...values);
      var max = Math.max(...values);

      // GeoJSON ì¬ì ìš©
      geojsonLayer = L.geoJSON(geojsonData, {
        style: function (feature) {
          var v = feature.properties[attribute];
          return {
            color: getColor(v, min, max),
            weight: 2,
            opacity: 0.9
          };
        }
      }).addTo(map);

      updateLegend(attribute, min, max);
    }

    // ğŸ”¥ ë²”ë¡€(legend) ì—…ë°ì´íŠ¸
    function updateLegend(attribute, min, max) {
      if (document.getElementById("legend")) {
        document.getElementById("legend").remove();
      }

      var legend = L.control({ position: "bottomright" });

      legend.onAdd = function () {
        var div = L.DomUtil.create("div", "info legend");
        div.id = "legend";
        div.innerHTML =
          "<b>" + attribute + "</b><br>" +
          "<i style='background:rgb(255,0,0);width:20px;height:10px;display:inline-block'></i> " + max.toFixed(2) + "<br>" +
          "<i style='background:rgb(255,255,0);width:20px;height:10px;display:inline-block'></i> " + min.toFixed(2) + "<br>";
        return div;
      };

      legend.addTo(map);
    }

    // ğŸ”½ ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì´ë²¤íŠ¸
    document.getElementById("attributeSelect")
      .addEventListener("change", function () {
        updateMap(this.value);
      });
  </script>

</body>
</html>
